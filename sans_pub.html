<html>
<head>
<title>MQTT Publish </title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>
</head>
<body>
    <h1>Bandung Weather News (input)</h1>
    Hostname: <input type="text" id="mqtt_server" value="broker.hivemq.com"><br><br>
    Port: <input type="text" id="mqtt_port" value="8000"><br><br>
    Topic: <input type="text" id="mqtt_destname" value="suhuBDG"><br><br>
    Sensor 1: <input type="tesxt" id="mqtt_msg1" value=""><br><br>
    Sensor 2: <input type="text" id="mqtt_msg2" value=""><br><br>
    Sensor 3: <input type="text" id="mqtt_msg3" value=""><br><br>

    <input type="button" id="publish_now" onclick="send_mqtt_msg()" value="Publish MQTT Message">
    <script>
        // Define some MQTT variables
        var mqtt_server = "";
        var mqtt_port = "";
        var mqtt_destname = "";
        var mqtt_msg1 ="";
        var mqtt_msg2 ="";
        var mqtt_msg3 ="";

        function send_mqtt_msg() {
            // Send an MQTT message
            mqtt_server = document.getElementById("mqtt_server").value;
            mqtt_port = Number(document.getElementById("mqtt_port").value);


            client = new Paho.MQTT.Client(mqtt_server, mqtt_port,"");
            client.connect({onSuccess:onConnect});
            document.getElementById("pubmsg").innerHTML = "Trying to connect...";
        }

        function onConnect() {
            document.getElementById("pubmsg").innerHTML = "New connection made...";
            var mqtt_destname = document.getElementById("mqtt_destname").value;
            var mqtt_msg1 = document.getElementById("mqtt_msg1").value;
            var mqtt_msg2 = document.getElementById("mqtt_msg2").value;
            var mqtt_msg3 = document.getElementById("mqtt_msg3").value;
            var mqtt_msg = mqtt_msg1 + " | " + mqtt_msg2+ " | " + mqtt_msg3;
            message = new Paho.MQTT.Message(mqtt_msg);
            message.destinationName = mqtt_destname;
            client.send(message);
            document.getElementById("pubmsg").innerHTML = "Bandung Weather Data: " + mqtt_msg + "      ...sent";
        }
        // called when a message arrives

    </script>
</body>
<hr>
<div id=pubmsg></div>
</html>
